# Continuous Translation

This action uses translate incrementally markdown document using [GitHub Models](https://github.com/models).

- [Documentation](https://pelikhan.github.io/action-continuous-translation/)
- [Blog post](https://microsoft.github.io/genaiscript/blog/continuous-translations/)
- [French](./README.fr.md)
- [Spanish](./README.es.md)

## How it work?

This action uses [GenAIScript](https://microsoft.github.io/genaiscript/) to programmatically analyze and translate markdown documents. The translation process works as follows:

- parse markdown file to AST (abstract syntax tree)
- visit tree and lookup existing translation or mark node that needs translation
- run LLM inference to collect new translations
- inject new translations in document and validate quality
- save translations to file cache
- commit changes

## Inputs

- `lang`: The iso-code target language for translation. (default: `fr`)
- `files`: Files to process, separated by semi columns. Default is `README.md`.
- `instructions`: Extra instructions for the LLM to use when translating.
- `instructions_file`: Path to a file containing extra instructions for the LLM to use when translating.
- `starlight_dir`: root folder of the Astro Starlight documentation.
- `starlight_base`: base alias for the Starlight documentation.

## Diagnostics

- `force`: Force translation even if the file has already been translated.
- `debug`: Enable debug logging (https://microsoft.github.io/genaiscript/reference/scripts/logging/).

### LLM configuration

- `github_token`: GitHub token with `models: read` permission at least (https://microsoft.github.io/genaiscript/reference/github-actions/#github-models-permissions). (default: `${{ secrets.GITHUB_TOKEN }}`)

- `openai_api_key`: OpenAI API key (default: `${{ secrets.OPENAI_API_KEY }}`)
- `openai_api_base`: OpenAI API base URL (default: `${{ env.OPENAI_API_BASE }}`)
- `azure_openai_api_endpoint`: Azure OpenAI endpoint. In the Azure Portal, open your Azure OpenAI resource, Keys and Endpoints, copy Endpoint. (default: `${{ env.AZURE_OPENAI_API_ENDPOINT }}`)
- `azure_openai_api_key`: Azure OpenAI API key. \*\*You do NOT need this if you are using Microsoft Entra ID. (default: `${{ secrets.AZURE_OPENAI_API_KEY }}`)
- `azure_openai_subscription_id`: Azure OpenAI subscription ID to list available deployments (Microsoft Entra only). (default: `${{ env.AZURE_OPENAI_SUBSCRIPTION_ID }}`)
- `azure_openai_api_version`: Azure OpenAI API version. (default: `${{ env.AZURE_OPENAI_API_VERSION }}`)
- `azure_openai_api_credentials`: Azure OpenAI API credentials type. Leave as 'default' unless you have a special Azure setup. (default: `${{ env.AZURE_OPENAI_API_CREDENTIALS }}`)

## Outputs

- `text`: The generated text output.

## Usage

Add the following to your step in your workflow file:

```yaml
uses: pelikhan/action-continuous-translation@v0
with:
  github_token: ${{ secrets.GITHUB_TOKEN }}
  lang: fr,es
```

## Example

Save this file in your `.github/workflows/` directory as `continuous-translation.yml`:

```yaml
name: Continuous Translation
on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - "README.md"
      - "docs/src/content/docs/**"
permissions:
  contents: write
  models: read
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
jobs:
  continuous_translation:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/cache@v4
        with:
          path: .genaiscript/cache/**
          key: continuous-translation-${{ github.run_id }}
          restore-keys: |
            continuous-translation-
      - uses: pelikhan/action-continuous-translation@v0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          lang: fr,es
      - uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: "translations/*.json **.md* translations/*.json"
          commit_message: "[cai] translated docs"
          commit_user_name: "genaiscript"
```

## Astro Starlight

The plugin supports translations Astro Starlight markdown or MDX files
for a site using a **rooted** default locale and a **base** alias for the documentation.

Configure the `starlight_dir` and `starlight_base` inputs to point to the root folder of your Astro Starlight documentation and the base alias for the documentation, respectively.

## Development

This action was automatically generated by GenAIScript from the script metadata.
We recommend updating the script metadata instead of editing the action files directly.

- the action inputs are inferred from the script parameters
- the action outputs are inferred from the script output schema
- the action description is the script description
- the readme description is the script description
- the action branding is the script branding

To **regenerate** the action files (`action.yml`), run:

```bash
npm run configure
```

To lint script files, run:

```bash
npm run lint
```

To typecheck the scripts, run:

```bash
npm run typecheck
```

To build the Docker image locally, run:

```bash
npm run docker:build
```

To run the action locally in Docker (build it first), use:

```bash
npm run docker:start
```

## Upgrade

The GenAIScript version is pinned in the `package.json` file. To upgrade it, run:

```bash
npm run upgrade
```

## Release

To release a new version of this action, run the release script on a clean working directory.

```bash
npm run release
```
